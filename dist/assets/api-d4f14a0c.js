/*! 
 Build based on gin-vue-admin 
 Time : 1705585352000 */
import{a as e,o as a,c as l,b as t,d as o,w as i,M as u,N as s,h as r,g as p,t as d,k as n,U as m,l as c,E as v,p as f,i as g}from"./index-0efc4537.js";import{E as h}from"./dialog-2a3abe36.js";import"./overlay-73152bda.js";import{E as b}from"./pagination-956e76f8.js";/* empty css              */import"./tag-c095386a.js";import{E as y,a as _}from"./select-59043028.js";import"./scrollbar-ab08f6f1.js";/* empty css               */import{E as j,a as V}from"./table-column-ce6481a3.js";import"./checkbox-aefa5e2d.js";/* empty css                */import{E as w}from"./popover-a0fd8f33.js";import{a as k,E as C}from"./form-150c0e00.js";/* empty css               *//* empty css                  */import{g as x,d as A,f as U,a as E,u as I,c as G,b as z}from"./api-3072964c.js";import{t as P}from"./stringFun-647a78e9.js";import{W as S}from"./warningBar-5328b630.js";import{_ as T}from"./_plugin-vue_export-helper-1b428a4d.js";import"./refs-04938f0e.js";import"./isUndefined-d281c39a.js";import"./isEqual-aa7e7ef2.js";import"./_Uint8Array-4999d338.js";import"./hasIn-deea815f.js";import"./index-70d4cce8.js";import"./index-c5b62cef.js";import"./strings-a95e1d29.js";import"./debounce-994b39f4.js";import"./index-4b62258d.js";import"./_initCloneObject-b273bb42.js";import"./dropdown-b49e545a.js";import"./castArray-f160d2a3.js";import"./_baseClone-9af99e91.js";/* empty css             */const q=e=>(f("data-v-2731e181"),e=e(),g(),e),D={class:"gva-search-box"},F={class:"gva-table-box"},B={class:"gva-btn-list"},O=q((()=>t("p",null,"确定要删除吗？",-1))),K={style:{"text-align":"right","margin-top":"8px"}},M=q((()=>t("p",null,"确定要刷新Casbin缓存吗？",-1))),L={style:{"text-align":"right","margin-top":"8px"}},N={class:"gva-pagination"},R={class:"dialog-footer"},W=T(Object.assign({name:"Api"},{__name:"api",setup(f){const g=e=>{const a=W.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},T=e([]),q=e({path:"",apiGroup:"",method:"",description:""}),W=e([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),H=e(""),J=e({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),Q=e(1),X=e(0),Y=e(10),Z=e([]),$=e({}),ee=()=>{$.value={}},ae=()=>{Q.value=1,Y.value=10,ie()},le=e=>{Y.value=e,ie()},te=e=>{Q.value=e,ie()},oe=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),$.value.orderKey=P(e),$.value.desc="descending"===a),ie()},ie=async()=>{const e=await x({page:Q.value,pageSize:Y.value,...$.value});0===e.code&&(Z.value=e.data.list,X.value=e.data.total,Q.value=e.data.page,Y.value=e.data.pageSize)};ie();const ue=e=>{T.value=e},se=e(!1),re=async()=>{const e=T.value.map((e=>e.ID)),a=await A({ids:e});0===a.code&&(n({type:"success",message:a.msg}),Z.value.length===e.length&&Q.value>1&&Q.value--,se.value=!1,ie())},pe=e(!1),de=async()=>{const e=await U();0===e.code&&n({type:"success",message:e.msg}),pe.value=!1},ne=e(null),me=e("新增Api"),ce=e(!1),ve=e=>{switch(e){case"addApi":me.value="新增Api";break;case"edit":me.value="编辑Api"}H.value=e,ce.value=!0},fe=()=>{ne.value.resetFields(),q.value={path:"",apiGroup:"",method:"",description:""},ce.value=!1},ge=async()=>{ne.value.validate((async e=>{if(e)switch(H.value){case"addApi":0===(await G(q.value)).code&&n({type:"success",message:"添加成功",showClose:!0}),ie(),fe();break;case"edit":0===(await I(q.value)).code&&n({type:"success",message:"编辑成功",showClose:!0}),ie(),fe();break;default:n({type:"error",message:"未知操作",showClose:!0})}}))};return(e,f)=>{const x=c,A=k,U=y,I=_,G=v,P=C,H=w,he=j,be=V,ye=b,_e=h;return a(),l("div",null,[t("div",D,[o(P,{ref:"searchForm",inline:!0,model:$.value},{default:i((()=>[o(A,{label:"路径"},{default:i((()=>[o(x,{modelValue:$.value.path,"onUpdate:modelValue":f[0]||(f[0]=e=>$.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),o(A,{label:"描述"},{default:i((()=>[o(x,{modelValue:$.value.description,"onUpdate:modelValue":f[1]||(f[1]=e=>$.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),o(A,{label:"API组"},{default:i((()=>[o(x,{modelValue:$.value.apiGroup,"onUpdate:modelValue":f[2]||(f[2]=e=>$.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),o(A,{label:"请求"},{default:i((()=>[o(I,{modelValue:$.value.method,"onUpdate:modelValue":f[3]||(f[3]=e=>$.value.method=e),clearable:"",placeholder:"请选择"},{default:i((()=>[(a(!0),l(u,null,s(W.value,(e=>(a(),r(U,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(A,null,{default:i((()=>[o(G,{type:"primary",icon:"search",onClick:ae},{default:i((()=>[p("查询")])),_:1}),o(G,{icon:"refresh",onClick:ee},{default:i((()=>[p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),t("div",F,[t("div",B,[o(G,{type:"primary",icon:"plus",onClick:f[4]||(f[4]=e=>ve("addApi"))},{default:i((()=>[p("新增")])),_:1}),o(H,{modelValue:se.value,"onUpdate:modelValue":f[7]||(f[7]=e=>se.value=e),placement:"top",width:"160"},{reference:i((()=>[o(G,{icon:"delete",disabled:!T.value.length,onClick:f[6]||(f[6]=e=>se.value=!0)},{default:i((()=>[p("删除")])),_:1},8,["disabled"])])),default:i((()=>[O,t("div",K,[o(G,{type:"primary",link:"",onClick:f[5]||(f[5]=e=>se.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(G,{type:"primary",onClick:re},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"]),o(H,{modelValue:pe.value,"onUpdate:modelValue":f[10]||(f[10]=e=>pe.value=e),placement:"top",width:"160"},{reference:i((()=>[o(G,{icon:"Refresh",onClick:f[9]||(f[9]=e=>pe.value=!0)},{default:i((()=>[p("刷新缓存")])),_:1})])),default:i((()=>[M,t("div",L,[o(G,{type:"primary",link:"",onClick:f[8]||(f[8]=e=>pe.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(G,{type:"primary",onClick:de},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"])]),o(be,{data:Z.value,onSortChange:oe,onSelectionChange:ue},{default:i((()=>[o(he,{type:"selection",width:"55"}),o(he,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),o(he,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),o(he,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),o(he,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),o(he,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:i((e=>[t("div",null,d(e.row.method)+" / "+d(g(e.row.method)),1)])),_:1}),o(he,{align:"left",fixed:"right",label:"操作",width:"200"},{default:i((e=>[o(G,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await E({id:e.ID});q.value=a.data.api,ve("edit")})(e.row)},{default:i((()=>[p("编辑")])),_:2},1032,["onClick"]),o(G,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{m.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await z(e)).code&&(n({type:"success",message:"删除成功!"}),1===Z.value.length&&Q.value>1&&Q.value--,ie())}))})(e.row)},{default:i((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t("div",N,[o(ye,{"current-page":Q.value,"page-size":Y.value,"page-sizes":[10,30,50,100],total:X.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:te,onSizeChange:le},null,8,["current-page","page-size","total"])])]),o(_e,{modelValue:ce.value,"onUpdate:modelValue":f[15]||(f[15]=e=>ce.value=e),"before-close":fe,title:me.value},{footer:i((()=>[t("div",R,[o(G,{onClick:fe},{default:i((()=>[p("取 消")])),_:1}),o(G,{type:"primary",onClick:ge},{default:i((()=>[p("确 定")])),_:1})])])),default:i((()=>[o(S,{title:"新增API，需要在角色管理内配置权限才可使用"}),o(P,{ref_key:"apiForm",ref:ne,model:q.value,rules:J.value,"label-width":"80px"},{default:i((()=>[o(A,{label:"路径",prop:"path"},{default:i((()=>[o(x,{modelValue:q.value.path,"onUpdate:modelValue":f[11]||(f[11]=e=>q.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(A,{label:"请求",prop:"method"},{default:i((()=>[o(I,{modelValue:q.value.method,"onUpdate:modelValue":f[12]||(f[12]=e=>q.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:i((()=>[(a(!0),l(u,null,s(W.value,(e=>(a(),r(U,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(A,{label:"api分组",prop:"apiGroup"},{default:i((()=>[o(x,{modelValue:q.value.apiGroup,"onUpdate:modelValue":f[13]||(f[13]=e=>q.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(A,{label:"api简介",prop:"description"},{default:i((()=>[o(x,{modelValue:q.value.description,"onUpdate:modelValue":f[14]||(f[14]=e=>q.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-2731e181"]]);export{W as default};
