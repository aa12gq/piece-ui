/*! 
 Build based on gin-vue-admin 
 Time : 1705585352000 */
import{s as a,a as e,$ as t,o as s,c as o,b as r,d as i,w as n,g as p,k as l,l as c,E as d}from"./index-0efc4537.js";import{E as u}from"./tree-1161bc64.js";import"./checkbox-aefa5e2d.js";/* empty css               *//* empty css              */import{e as h}from"./api-3072964c.js";import"./index-55d5e59b.js";import"./isEqual-aa7e7ef2.js";import"./_Uint8Array-4999d338.js";import"./hasIn-deea815f.js";const m={class:"sticky top-0.5 z-10 bg-white"},y={class:"tree-content"},f=Object.assign({name:"Apis"},{__name:"apis",props:{row:{default:function(){return{}},type:Object}},setup(f,{expose:v}){const b=f,j=e({children:"children",label:"description"}),k=e(""),g=e([]),w=e([]),I=e("");(async()=>{const e=(await h()).data.apis;g.value=O(e);const t=await(s={authorityId:b.row.authorityId},a({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;I.value=b.row.authorityId,w.value=[],t.data.paths&&t.data.paths.forEach((a=>{w.value.push("p:"+a.path+"m:"+a.method)}))})();const x=e(!1),E=()=>{x.value=!0},O=a=>{const e={};a&&a.forEach((a=>{a.onlyId="p:"+a.path+"m:"+a.method,Object.prototype.hasOwnProperty.call(e,a.apiGroup)?e[a.apiGroup].push(a):Object.assign(e,{[a.apiGroup]:[a]})}));const t=[];for(const s in e){const a={ID:s,description:s+"组",children:e[s]};t.push(a)}return t},C=e(null),_=async()=>{const e=C.value.getCheckedNodes(!0);var t=[];e&&e.forEach((a=>{var e={path:a.path,method:a.method};t.push(e)}));var s;0===(await(s={authorityId:I.value,casbinInfos:t},a({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&l({type:"success",message:"api设置成功"})};v({needConfirm:x,enterAndNext:()=>{_()}});const A=(a,e)=>!a||-1!==e.description.indexOf(a);return t(k,(a=>{C.value.filter(a)})),(a,e)=>{const t=c,l=d,h=u;return s(),o("div",null,[r("div",m,[i(t,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),class:"w-3/5",placeholder:"筛选"},null,8,["modelValue"]),i(l,{class:"float-right",type:"primary",onClick:_},{default:n((()=>[p("确 定")])),_:1})]),r("div",y,[i(h,{ref_key:"apiTree",ref:C,data:g.value,"default-checked-keys":w.value,props:j.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"","filter-node-method":A,onCheck:E},null,8,["data","default-checked-keys","props"])])])}}});export{f as default};
