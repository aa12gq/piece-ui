/*! 
 Build based on gin-vue-admin 
 Time : 1705585352000 */
import{a as e,$ as a,r as t,P as l,W as o,o as n,c as r,d as s,b as i,w as u,g as c,t as d,h as m,e as p,M as f,N as g,n as y,aI as v,U as _,k as b,l as w,E as h,J as k}from"./index-0efc4537.js";import{E as C}from"./drawer-25d6170f.js";import"./overlay-73152bda.js";import{a as x,E as j}from"./form-150c0e00.js";import{E as V}from"./upload-276f24ce.js";import"./progress-6c49b316.js";import{E as R,a as D}from"./radio-86f43203.js";import{E as I,a as T}from"./col-cb4ff1b9.js";/* empty css             *//* empty css              */import"./tag-c095386a.js";import{E as U,a as E}from"./select-59043028.js";import"./scrollbar-ab08f6f1.js";/* empty css               *//* empty css                  */import{E as A}from"./pagination-956e76f8.js";import{E as z,a as F}from"./table-column-ce6481a3.js";import"./checkbox-aefa5e2d.js";/* empty css                *//* empty css               */import{E as P,a as S,b as B}from"./dropdown-item-9e4a6efb.js";import{g as N,d as L,P as q,R as M,c as O,D as G,a as J,b as W,e as $,f as H,h as Y,i as Z,j as K}from"./registerTask-9f09bb27.js";import{g as Q}from"./country-15c2ea1e.js";import{W as X}from"./warningBar-5328b630.js";import{g as ee}from"./accoutTag-60f16314.js";import{g as ae}from"./accoutGroup-85ef6fd8.js";import{E as te}from"./index-70d4cce8.js";import"./isUndefined-d281c39a.js";import"./castArray-f160d2a3.js";import"./_baseClone-9af99e91.js";import"./_Uint8Array-4999d338.js";import"./_initCloneObject-b273bb42.js";import"./cloneDeep-585751f1.js";import"./isEqual-aa7e7ef2.js";import"./hasIn-deea815f.js";import"./index-c5b62cef.js";import"./strings-a95e1d29.js";import"./debounce-994b39f4.js";import"./index-4b62258d.js";import"./dropdown-b49e545a.js";import"./refs-04938f0e.js";const le={class:"authority"},oe={class:"gva-table-box"},ne={class:"gva-btn-list"},re=i("br",null,null,-1),se=i("br",null,null,-1),ie={class:"button-group"},ue={class:"text-sm text-orange-300 mt-2"},ce={key:0},de=Object.assign({name:"Register"},{__name:"index",setup(de){const me=e=>{e()},pe=e(!1),fe=e("0"),ge=e(1),ye=e(0),ve=e(10),_e=e([]),be=e(""),we=e(""),he=e(!1),ke=e=>{ge.value=e,Ve()},Ce=e=>{ve.value=e,Ve()};a((()=>pe.value),(e=>{e&&ze()}));const xe=e({concurrencyLimit:0,currentConcurrency:0}),je=async()=>{he.value=!0;const e=await v();xe.value=e.data,setTimeout((()=>{he.value=!1}),1e3)},Ve=async(e,a)=>{const t=await N({page:ge.value,pageSize:ve.value,taskName:we.value,sort:e,order:a});0===t.code&&(_e.value=[],setTimeout((()=>{_e.value=t.data.list}),100),ye.value=t.data.total,ge.value=t.data.page,ve.value=t.data.pageSize)};Ve();const Re=e=>{switch(e){case"Pending":return"等待";case"Success":return"已成功";case"Failed":return"失败";case"Running":return"运行中";case"Pause":return"已暂停";default:return""}},De=e=>{switch(e){case"Pending":return"warning";case"Success":return"success";case"Failed":case"Pause":return"danger";case"Running":return"info";default:return""}},Ie=e=>{switch(e){case"Pending":return"el-icon-clock";case"Success":return"CircleCheck";case"Failed":return"el-icon-circle-close";case"Running":return"el-icon-loading";case"Pause":return"VideoPlay";default:return""}},Te=e(null),Ue=e([]),Ee=(e,a)=>{Ue.value=a,a.length>0?Ae.file=a[0].raw:Ae.file=null},Ae=t({taskName:"",country_id:null,concurrency:1,file:null,tag_id:null,immediate:!0,group_id:null,targetCount:null,mode:""}),ze=()=>{l((()=>{Form.value?Form.value.resetFields():console.error("The form reference 'Form' is not available.")})),Me(),Le(),Ge(),Ae.value={taskName:"",country_id:null,concurrency:1,tag_id:null,immediate:!0,group_id:null,targetCount:null}},Fe={taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],country_id:[{required:!0,message:"请选择国家区号",trigger:"blur"}],mode:[{required:!0,message:"请选择注册模式",trigger:"blur"}],concurrency:[{required:!0,message:"请输入并发数",trigger:"blur"},{type:"number",message:"并发数必须为数字值",trigger:"blur"}],file:[{validator:(e,a,t)=>{"0"!==fe.value||a?t():t(new Error("请上传文件"))},trigger:"change"}],targetCount:[{validator:(e,a,t)=>{"1"!==fe.value||a?t():t(new Error("请输入目标数量"))},trigger:"blur"}]},Pe=async()=>{if(!(await Te.value.validate()))return;const e=new FormData;e.append("taskName",Ae.taskName),e.append("country_id",Ae.country_id),e.append("concurrency",Ae.concurrency),e.append("tag_id",Ae.tag_id),e.append("group_id",Ae.group_id),e.append("immediate",Ae.immediate),"0"===fe.value&&Ae.file&&e.append("file",Ae.file,Ae.file.name),"1"===fe.value&&e.append("targetCount",Ae.targetCount),e.append("mode",fe.value);try{0===(await O(e)).code&&(b.success("创建成功！"),setTimeout((()=>{Ve()}),500))}catch(a){b.error(a.message||"创建任务失败")}},Se=()=>{Te.value&&Te.value.resetFields()},Be=async(e,a,t,l=3e3)=>{try{b.info("准备下载，请稍候...");const o=await e(a.ID);if(o&&o.data){console.log("开始下载 ".concat(t),o);const e=new Blob([o.data],{type:"text/plain"});setTimeout((()=>{const a=window.URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),b.success("下载成功")}),l)}else b.error("下载 ".concat(t," 失败：没有数据返回"))}catch(o){b.error("下载出错"),console.error("下载出错",o)}},Ne=e([]),Le=async()=>{const e=await ae(1,100);0===e.code&&Array.isArray(e.data.list)&&(Ne.value=[],setTimeout((()=>{Ne.value=e.data.list}),100),ye.value=e.data.total,ge.value=e.data.page,ve.value=e.data.pageSize)},qe=e([]),Me=async()=>{const e=await ee(1,100);0===e.code&&(qe.value=[],setTimeout((()=>{qe.value=e.data.list}),100),ye.value=e.data.total,ge.value=e.data.page,ve.value=e.data.pageSize)},Oe=e([]),Ge=async()=>{const e=await Q(1,300);0===e.code&&Array.isArray(e.data.list)&&(Oe.value=[],setTimeout((()=>{Oe.value=e.data.list}),100),ye.value=e.data.total,ge.value=e.data.page,ve.value=e.data.pageSize)},Je=e(null),We=e([]),$e=e=>{We.value=e};return(e,a)=>{const t=w,l=h,v=te,N=z,O=P,Q=S,ee=B,ae=F,de=A,we=x,ze=U,Le=E,Me=o("Refresh"),Ge=k,He=I,Ye=T,Ze=R,Ke=D,Qe=V,Xe=j,ea=C;return n(),r("div",le,[s(X,{title:"注：账号批量注册"}),i("div",oe,[i("div",ne,[s(t,{modelValue:be.value,"onUpdate:modelValue":a[0]||(a[0]=e=>be.value=e),placeholder:"请输入任务名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),s(l,{type:"primary",icon:"Search"},{default:u((()=>[c("搜索")])),_:1}),s(l,{type:"primary",icon:"CirclePlus",onClick:a[1]||(a[1]=()=>{pe.value=!0,je()})},{default:u((()=>[c("新建任务")])),_:1}),s(v,{placement:"top"},{content:u((()=>[c(" 选择任一任务并暂停。请注意，发送暂停信号后可能会有短暂延迟才能完全停止"),re])),default:u((()=>[s(l,{icon:"Bell",type:"primary",disabled:1!=We.value.length,onClick:a[2]||(a[2]=e=>(1!==We.value.length&&b({type:"info",message:"目前暂停任务只支持单个任务进行暂停"}),void _.confirm("此操作将暂停该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await q(We.value[0].ID);0!==e.code&&null!=e||(b({type:"success",message:"任务暂停成功 !"}),Ve(),_e.value.some((e=>"Running"===e.status))||stopAutoRefresh())})).catch((()=>{b({type:"info",message:"已取消暂停"})}))))},{default:u((()=>[c("暂停任务")])),_:1},8,["disabled"])])),_:1}),s(v,{placement:"top"},{content:u((()=>[c(" 选择任一已暂停任务。请注意，发送恢复信号后可能会有短暂延迟才能完全停止"),se])),default:u((()=>[s(l,{icon:"Bell",type:"primary",disabled:1!=We.value.length,onClick:a[3]||(a[3]=e=>(1!==We.value.length&&b({type:"info",message:"目前恢复任务只支持单个任务进行恢复"}),void _.confirm("您确定要恢复该任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await M(We.value[0].ID)).code&&(b({type:"success",message:"任务恢复成功 !"}),Ve(),_e.value.some((e=>"Running"===e.status))||stopAutoRefresh())})).catch((()=>{b({type:"info",message:"已取消恢复任务"})}))))},{default:u((()=>[c("恢复任务")])),_:1},8,["disabled"])])),_:1}),s(l,{type:"primary",icon:"refresh",onClick:a[4]||(a[4]=e=>Ve())},{default:u((()=>[c("刷新")])),_:1}),s(v,{class:"box-item",effect:"dark",content:"暂未开发，敬请期待",placement:"top-start"}),s(v,{class:"box-item",effect:"dark",content:"暂未开发，敬请期待",placement:"top-start"}),s(v,{class:"box-item",effect:"dark",content:"暂未开发，敬请期待",placement:"top-start"})]),s(ae,{ref_key:"multipleTableRef",ref:Je,data:_e.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"},onSelectionChange:$e},{default:u((()=>[s(N,{type:"selection",width:"55"}),s(N,{label:"ID","min-width":"100",prop:"ID"}),s(N,{align:"left",label:"任务名称","min-width":"130",prop:"task_name"}),s(N,{align:"left",label:"任务状态","min-width":"150"},{default:u((({row:e})=>[s(l,{type:De(e.status),size:"small",loading:"Running"==e.status,icon:Ie(e.status),plain:""},{default:u((()=>[c(d(Re(e.status)),1)])),_:2},1032,["type","loading","icon"])])),_:1}),s(N,{align:"left",label:"并发数","min-width":"130",prop:"concurrency"}),s(N,{align:"left",label:"成功","min-width":"130",prop:"success_count"}),s(N,{align:"left",label:"封号","min-width":"130",prop:"blocked_count"}),s(N,{align:"left",label:"风控1小时","min-width":"130"},{default:u((e=>[c(d(e.row.no_routes_count+e.row.too_recent_count),1)])),_:1}),s(N,{align:"left",label:"累计消耗(抢到卡)","min-width":"150",prop:"get_phone_count"}),s(N,{align:"left",label:"非官方","min-width":"130",prop:"office_count"}),s(N,{align:"left",label:"总数","min-width":"100",prop:"target_success_count"}),s(N,{align:"left",label:"创建时间","min-width":"180",prop:"formattedCreatedAt"}),s(N,{align:"left",label:"更新时间","min-width":"180",prop:"formattedUpdatedAt"}),s(N,{align:"left",label:"操作",width:"260",fixed:"right"},{default:u((a=>[i("div",ie,[s(l,{icon:"Files",type:"primary",link:"",onClick:t=>e.$router.push({name:"subtask",params:{id:a.row.ID}})},{default:u((()=>[c("详情")])),_:2},1032,["onClick"]),s(l,{icon:"delete",type:"primary",link:"",disabled:"Running"==a.row.status,onClick:e=>{return t=a.row,void _.confirm("此操作将永久删除该任务及相关账号, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await L({ID:t.ID});0!==e.code&&null!=e||(b({type:"success",message:"任务删除成功 !"}),1===_e.value.length&&ge.value>1&&ge.value--,Ve(),_e.value.some((e=>"Running"===e.status))||stopAutoRefresh())})).catch((()=>{b({type:"info",message:"已取消删除"})}));var t}},{default:u((()=>[c("删除")])),_:2},1032,["disabled","onClick"]),s(ee,{trigger:"click",class:"el-button-like"},{dropdown:u((()=>[s(Q,null,{default:u((()=>[a.row.nonDisabledAccounts>0&&a.row.DisabledAccounts>0?(n(),m(O,{key:0},{default:u((()=>[c("什么都没有")])),_:1})):p("",!0),s(O,{onClick:e=>(async e=>{await Be(Z,e,"未执行账号.txt")})(a.row)},{default:u((()=>[c("下载未执行账号(txt)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be(K,e,"未执行账号.xlsx")})(a.row)},{default:u((()=>[c("下载未执行账号(excel)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be(G,e,"封锁账号.txt")})(a.row)},{default:u((()=>[c("下载封号账号(txt)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be(J,e,"封锁账号.xlsx")})(a.row)},{default:u((()=>[c("下载封号账号(xlsx)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be(W,e,"风控账号.txt")})(a.row)},{default:u((()=>[c("下载风控账号(txt)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be($,e,"风控账号.xlsx")})(a.row)},{default:u((()=>[c("下载风控账号(xlsx)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be(H,e,"成功账号.txt")})(a.row)},{default:u((()=>[c("下载成功账号(txt)")])),_:2},1032,["onClick"]),s(O,{onClick:e=>(async e=>{await Be(Y,e,"成功账号.xlsx")})(a.row)},{default:u((()=>[c("下载成功账号(xlsx)")])),_:2},1032,["onClick"])])),_:2},1024)])),default:u((()=>[s(l,{class:"button-with-icon-right ml-3",type:"primary",link:"",icon:"More"},{default:u((()=>[c("更多操作")])),_:1})])),_:2},1024)])])),_:1})])),_:1},8,["data"]),s(de,{"current-page":ge.value,"page-size":ve.value,"page-sizes":[10,30,50,100],total:ye.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ke,onSizeChange:Ce},null,8,["current-page","page-size","total"])]),s(ea,{modelValue:pe.value,"onUpdate:modelValue":a[13]||(a[13]=e=>pe.value=e),title:"新建任务","before-close":me},{default:u((()=>[s(Xe,{ref_key:"formRef",ref:Te,model:Ae,rules:Fe,"label-width":"120px"},{default:u((()=>[s(we,{label:"任务名称",prop:"taskName"},{default:u((()=>[s(t,{modelValue:Ae.taskName,"onUpdate:modelValue":a[5]||(a[5]=e=>Ae.taskName=e),autocomplete:"off",placeholder:"请输入任务名称"},null,8,["modelValue"])])),_:1}),s(we,{label:"国家区号",prop:"country"},{default:u((()=>[s(Le,{modelValue:Ae.country_id,"onUpdate:modelValue":a[6]||(a[6]=e=>Ae.country_id=e),filterable:"",placeholder:"请选择国家区号",style:{width:"100%"}},{default:u((()=>[(n(!0),r(f,null,g(Oe.value,(e=>(n(),m(ze,{key:e.ID,label:"".concat(e.code," ").concat(e.name," ").concat(e.dialingCode),value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(we,{label:"并发数",prop:"concurrency"},{default:u((()=>[s(t,{modelValue:Ae.concurrency,"onUpdate:modelValue":a[7]||(a[7]=e=>Ae.concurrency=e),modelModifiers:{number:!0},type:"number",placeholder:"并发数",min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"]),i("span",ue,"当前可用并发数"+d(xe.value.concurrencyLimit-xe.value.currentConcurrency),1),s(Ge,{class:y(["mt-2 cursor-pointer",{rotate:he.value}]),style:{"margin-left":"4px"},size:12,onClick:a[8]||(a[8]=e=>je())},{default:u((()=>[s(Me)])),_:1},8,["class"])])),_:1}),s(Ye,null,{default:u((()=>[s(He,null,{default:u((()=>[s(we,{label:"标签"},{default:u((()=>[s(Le,{modelValue:Ae.tag_id,"onUpdate:modelValue":a[9]||(a[9]=e=>Ae.tag_id=e),class:"w-full",placeholder:"请选择标签"},{default:u((()=>[(n(!0),r(f,null,g(qe.value,(e=>(n(),m(ze,{key:e.ID,label:e.name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(Ye,null,{default:u((()=>[s(He,null,{default:u((()=>[s(we,{label:"分组"},{default:u((()=>[s(Le,{modelValue:Ae.group_id,"onUpdate:modelValue":a[10]||(a[10]=e=>Ae.group_id=e),class:"w-full",placeholder:"请选择分组"},{default:u((()=>[(n(!0),r(f,null,g(Ne.value,(e=>(n(),m(ze,{key:e.ID,label:e.name,value:e.ID},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(Ye,null,{default:u((()=>[s(He,null,{default:u((()=>[s(we,{label:"注册模式"},{default:u((()=>[s(Ke,{modelValue:fe.value,"onUpdate:modelValue":a[11]||(a[11]=e=>fe.value=e),class:"ml-4"},{default:u((()=>[s(Ze,{label:"0",size:"large"},{default:u((()=>[c("文本上传")])),_:1}),s(Ze,{label:"1",size:"large"},{default:u((()=>[c("卡商注册")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),s(Ye,{gutter:20}),"0"===fe.value?(n(),m(we,{key:0,label:"上传文件",prop:"file"},{default:u((()=>[s(Qe,{class:"upload-demo","file-list":Ue.value,"on-change":Ee,"before-upload":()=>!1},{default:u((()=>[s(l,{slot:"trigger"},{default:u((()=>[c("选择文件")])),_:1})])),_:1},8,["file-list"]),Ae.file?(n(),r("div",ce,d(Ae.file.name),1)):p("",!0)])),_:1})):p("",!0),"1"===fe.value?(n(),m(we,{key:1,label:"目标总数",prop:"targetCount"},{default:u((()=>[s(t,{modelValue:Ae.targetCount,"onUpdate:modelValue":a[12]||(a[12]=e=>Ae.targetCount=e),modelModifiers:{number:!0},type:"number",placeholder:"请输入目标总数",min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])])),_:1})):p("",!0),s(we,null,{default:u((()=>[s(l,{type:"primary",icon:"Position",class:"w-[7rem] rounded",onClick:Pe},{default:u((()=>[c(" 提交 ")])),_:1}),s(l,{icon:"RefreshLeft",class:"w-[7rem] rounded",onClick:Se},{default:u((()=>[c(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}});export{de as default};
