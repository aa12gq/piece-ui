/*! 
 Build based on gin-vue-admin 
 Time : 1705585352000 */
import{a,o as e,c as t,d as l,b as o,w as r,g as i,h as u,e as d,U as s,k as n,E as m,l as p}from"./index-0efc4537.js";import{E as h}from"./drawer-25d6170f.js";import"./overlay-73152bda.js";import{E as y,a as c}from"./tab-pane-5f57c34e.js";import{E as v}from"./dialog-2a3abe36.js";import{a as f,E as I}from"./form-150c0e00.js";/* empty css              *//* empty css                  */import{E as j}from"./cascader-panel-8d54ab04.js";/* empty css               */import"./tag-c095386a.js";import"./checkbox-aefa5e2d.js";import"./radio-86f43203.js";import"./scrollbar-ab08f6f1.js";import{E as g,a as b}from"./table-column-ce6481a3.js";/* empty css                *//* empty css               */import{g as w,d as _,c as k,u as C,a as N}from"./authority-0dff6ed3.js";import x from"./menus-cb53e5be.js";import V from"./apis-53c6af87.js";import E from"./datas-bcffbe9d.js";import{W as A}from"./warningBar-5328b630.js";import"./isUndefined-d281c39a.js";import"./strings-a95e1d29.js";import"./refs-04938f0e.js";import"./castArray-f160d2a3.js";import"./_baseClone-9af99e91.js";import"./_Uint8Array-4999d338.js";import"./_initCloneObject-b273bb42.js";import"./rand-099990c4.js";import"./isEqual-aa7e7ef2.js";import"./cloneDeep-585751f1.js";import"./index-70d4cce8.js";import"./index-c5b62cef.js";import"./index-4b62258d.js";import"./debounce-994b39f4.js";import"./hasIn-deea815f.js";import"./tree-1161bc64.js";import"./index-55d5e59b.js";import"./authorityBtn-d967b7d6.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./api-3072964c.js";/* empty css             */const U={class:"authority"},D={class:"gva-table-box"},q={class:"gva-btn-list"},B={class:"dialog-footer"},F=Object.assign({name:"Authority"},{__name:"authority",setup(F){const S=a([{authorityId:0,authorityName:"根角色"}]),z=a(!1),R=a("add"),O=a({}),T=a("新增角色"),W=a(!1),G=a(!1),H=a({}),J=a({authorityId:0,authorityName:"",parentId:0}),K=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),M=a(1),P=a(0),X=a(999),$=a([]),L=a({}),Q=async()=>{const a=await w({page:M.value,pageSize:X.value,...L.value});0===a.code&&($.value=a.data.list,P.value=a.data.total,M.value=a.data.page,X.value=a.data.pageSize)};Q();const Y=(a,e)=>{O.value[a]=e},Z=a(null),aa=a(null),ea=a(null),ta=(a,e)=>{const t=[Z,aa,ea];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},la=a(null),oa=()=>{la.value&&la.value.resetFields(),J.value={authorityId:0,authorityName:"",parentId:0}},ra=()=>{oa(),W.value=!1,G.value=!1},ia=()=>{la.value.validate((async a=>{if(a){switch(J.value.authorityId=Number(J.value.authorityId),R.value){case"add":0===(await N(J.value)).code&&(n({type:"success",message:"添加成功!"}),Q(),ra());break;case"edit":0===(await C(J.value)).code&&(n({type:"success",message:"添加成功!"}),Q(),ra());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=J.value.authorityId,a.authority.authorityName=J.value.authorityName,a.authority.parentId=J.value.parentId,a.authority.dataAuthorityId=H.value.dataAuthorityId,a.oldAuthorityId=H.value.authorityId;0===(await k(a)).code&&(n({type:"success",message:"复制成功！"}),Q())}}oa(),W.value=!1}}))},ua=()=>{S.value=[{authorityId:0,authorityName:"根角色"}],da($.value,S.value,!1)},da=(a,e,t)=>{J.value.authorityId=String(J.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===J.value.authorityId,children:[]};da(a.children,l.children,t||a.authorityId===J.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===J.value.authorityId};e.push(l)}}))},sa=a=>{oa(),T.value="新增角色",R.value="add",J.value.parentId=a,ua(),W.value=!0};return(a,w)=>{const k=m,C=g,N=b,F=j,G=f,P=p,X=I,L=v,oa=y,da=c,na=h;return e(),t("div",U,[l(A,{title:"注：右上角头像下拉可切换角色"}),o("div",D,[o("div",q,[l(k,{type:"primary",icon:"plus",onClick:w[0]||(w[0]=a=>sa(0))},{default:r((()=>[i("新增角色")])),_:1})]),l(N,{data:$.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(C,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(C,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(C,{align:"left",label:"操作",width:"460"},{default:r((a=>[l(k,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,z.value=!0,void(O.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(k,{icon:"plus",type:"primary",link:"",onClick:e=>sa(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(k,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{ua(),T.value="拷贝角色",R.value="copy";for(const e in J.value)J.value[e]=a[e];H.value=a,W.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(k,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{ua(),T.value="编辑角色",R.value="edit";for(const e in J.value)J.value[e]=a[e];ua(),W.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(k,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void s.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await _({authorityId:t.authorityId})).code&&(n({type:"success",message:"删除成功!"}),1===$.value.length&&M.value>1&&M.value--,Q())})).catch((()=>{n({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(L,{modelValue:W.value,"onUpdate:modelValue":w[4]||(w[4]=a=>W.value=a),title:T.value},{footer:r((()=>[o("div",B,[l(k,{onClick:ra},{default:r((()=>[i("取 消")])),_:1}),l(k,{type:"primary",onClick:ia},{default:r((()=>[i("确 定")])),_:1})])])),default:r((()=>[l(X,{ref_key:"authorityForm",ref:la,model:J.value,rules:K.value,"label-width":"80px"},{default:r((()=>[l(G,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(F,{modelValue:J.value.parentId,"onUpdate:modelValue":w[1]||(w[1]=a=>J.value.parentId=a),style:{width:"100%"},disabled:"add"===R.value,options:S.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(G,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(P,{modelValue:J.value.authorityId,"onUpdate:modelValue":w[2]||(w[2]=a=>J.value.authorityId=a),disabled:"edit"===R.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(G,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(P,{modelValue:J.value.authorityName,"onUpdate:modelValue":w[3]||(w[3]=a=>J.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),z.value?(e(),u(na,{key:0,modelValue:z.value,"onUpdate:modelValue":w[5]||(w[5]=a=>z.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(da,{"before-leave":ta,type:"border-card"},{default:r((()=>[l(oa,{label:"角色菜单"},{default:r((()=>[l(x,{ref_key:"menus",ref:Z,row:O.value,onChangeRow:Y},null,8,["row"])])),_:1}),l(oa,{label:"角色api"},{default:r((()=>[l(V,{ref_key:"apis",ref:aa,row:O.value,onChangeRow:Y},null,8,["row"])])),_:1}),l(oa,{label:"资源权限"},{default:r((()=>[l(E,{ref_key:"datas",ref:ea,authority:$.value,row:O.value,onChangeRow:Y},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):d("",!0)])}}});export{F as default};
